generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enum: Permissões de acesso dos usuários no sistema - Define os níveis de permissão para controle de acesso às funcionalidades
enum Permissao {
  DEV // Desenvolvedor: Acesso total ao sistema, incluindo configurações e desenvolvimento
  ADM // Administrador: Acesso administrativo completo, pode gerenciar usuários e processos
  TEC // Técnico: Pode criar e gerenciar processos e andamentos
  USR // Usuário: Acesso básico, apenas visualização de processos e andamentos
}

// Enum: Status do andamento do processo - Indica em qual situação se encontra o andamento do processo
enum StatusAndamento {
  EM_ANDAMENTO // Processo está em tramitação, aguardando retorno
  CONCLUIDO // Processo foi concluído e retornado à unidade de origem
  PRORROGADO // Prazo foi prorrogado, nova data limite definida
}

// Enum: Tipos de ações registradas no log do sistema - Define os tipos de operações que podem ser registradas
enum TipoAcao {
  PROCESSO_CRIADO // Processo foi criado no sistema
  PROCESSO_ATUALIZADO // Processo foi atualizado (número SEI ou assunto alterado)
  PROCESSO_REMOVIDO // Processo foi removido do sistema
  ANDAMENTO_CRIADO // Andamento foi criado (processo enviado de uma unidade para outra)
  ANDAMENTO_ATUALIZADO // Andamento foi atualizado (origem, destino, prazo ou observação alterados)
  ANDAMENTO_PRORROGADO // Prazo do andamento foi prorrogado
  ANDAMENTO_CONCLUIDO // Andamento foi concluído (processo retornado)
  ANDAMENTO_REMOVIDO // Andamento foi removido do sistema
}

// Model: Unidade | Tabela: unidades | Descrição: Armazena informações das unidades organizacionais do sistema
model Unidade {
  id           String   @id @default(uuid()) // ID único da unidade (UUID gerado automaticamente) - Chave primária
  nome         String   @unique // Nome completo da unidade - Obrigatório - Único - Exemplo: "Coordenadoria Jurídica"
  sigla        String   @unique // Sigla da unidade - Obrigatório - Único - Exemplo: "COJUR"
  ativo        Boolean  @default(true) // Indica se a unidade está ativa (true) ou foi excluída logicamente (false) - Boolean - Valor padrão: true
  criadoEm     DateTime @default(now()) // Data e hora de criação do registro da unidade - DateTime - Valor padrão: Data/hora atual (definido apenas na criação)
  atualizadoEm DateTime @default(now()) @updatedAt // Data e hora da última atualização do registro - DateTime - Atualizado automaticamente a cada modificação

  usuarios  Usuario[] // Lista de usuários pertencentes a esta unidade - Array de Usuario - Usuários vinculados à unidade
  processos processo[] // Lista de processos cadastrados por esta unidade - Array de processo - Processos vinculados à unidade

  @@map("unidades")
}

// Model: Usuario | Tabela: usuarios | Descrição: Armazena informações dos usuários do sistema (servidores da secretaria)
model Usuario {
  id         String    @id @default(uuid()) // ID único do usuário (UUID gerado automaticamente) - Chave primária
  nome       String // Nome completo do usuário - Obrigatório - Exemplo: "João da Silva"
  nomeSocial String? // Nome social do usuário (opcional) - Nome pelo qual o usuário prefere ser chamado
  login      String    @unique // Login do usuário para acesso ao sistema - Obrigatório - Único - Exemplo: "joao.silva"
  email      String    @unique // E-mail do usuário - Obrigatório - Único - Deve ser um e-mail válido - Exemplo: "joao.silva@prefeitura.gov.br"
  permissao  Permissao @default(USR) // Permissão de acesso do usuário no sistema - Enum (Permissao) - Valor padrão: USR - Valores: DEV, ADM, TEC, USR
  status     Boolean   @default(true) // Status ativo/inativo do usuário - Boolean - Valor padrão: true (ativo) - false = usuário desativado, não pode acessar o sistema
  avatar     String?   // URL ou caminho da imagem de avatar do usuário - String (TEXT no banco) - Opcional - Armazena URL ou base64 da foto
  unidade_id String // ID da unidade à qual o usuário pertence (chave estrangeira) - String (UUID) - Obrigatório - Referência à unidade do usuário
  unidade    Unidade   @relation(fields: [unidade_id], references: [id]) // Relacionamento com o modelo Unidade - Unidade à qual o usuário pertence

  ultimoLogin  DateTime @default(now()) // Data e hora do último login do usuário no sistema - DateTime - Valor padrão: Data/hora atual (atualizado a cada login)
  criadoEm     DateTime @default(now()) // Data e hora de criação do registro do usuário - DateTime - Valor padrão: Data/hora atual (definido apenas na criação)
  atualizadoEm DateTime @default(now()) @updatedAt // Data e hora da última atualização do registro - DateTime - Atualizado automaticamente a cada modificação

  andamentosCriados     andamento[] @relation("AndamentoCriadoPor") // Lista de andamentos criados por este usuário - Array de andamento - Histórico de andamentos criados pelo usuário
  andamentosProrrogados andamento[] @relation("AndamentoProrrogadoPor") // Lista de andamentos prorrogados por este usuário - Array de andamento - Histórico de andamentos prorrogados pelo usuário
  logs                  Log[] // Lista de logs de ações realizadas por este usuário - Array de Log - Histórico completo de ações do usuário no sistema

  @@map("usuarios")
}

// Model: processo | Tabela: processos | Descrição: Armazena informações dos processos administrativos que são controlados pelo sistema
model processo {
  id                      String      @id @default(uuid()) // ID único do processo (UUID gerado automaticamente) - Chave primária
  numero_sei              String      @unique // Número SEI (Sistema Eletrônico de Informações) do processo - String - Obrigatório - Único - Número único que identifica o processo no sistema SEI - Exemplo: "1234567"
  assunto                 String // Assunto do processo - String - Obrigatório - Descrição resumida do que trata o processo - Exemplo: "Solicitação de licença para obra"
  origem                  String      @default("EXPEDIENTE") // Unidade de origem do processo - String - Obrigatório - Unidade que originou/solicitou o processo - Exemplo: "EXPEDIENTE", "COORDENADORIA_JURIDICA" - Valor padrão: EXPEDIENTE
  data_recebimento        DateTime    @default(now()) // Data em que o gabinete recebeu o processo - DateTime - Valor padrão: Data/hora atual - Pode ser data atual ou anterior
  data_resposta_final     DateTime? // Data em que o gabinete respondeu o processo ao solicitante - DateTime (opcional) - Data de fechamento/conclusão do processo
  resposta_final          String? // Resposta final dada ao processo - String (opcional) - Texto com a resposta/despacho final do processo
  unidade_respondida_id   String? // ID/Sigla da unidade que foi respondida - String (opcional) - Identifica qual unidade recebeu a resposta final
  ativo                   Boolean     @default(true) // Indica se o processo está ativo (true) ou foi excluído logicamente (false) - Boolean - Valor padrão: true
  unidade_id              String // ID da unidade que cadastrou o processo (chave estrangeira) - String (UUID) - Obrigatório - Referência à unidade responsável pelo processo
  unidade                 Unidade     @relation(fields: [unidade_id], references: [id]) // Relacionamento com o modelo Unidade - Unidade que cadastrou o processo
  criadoEm                DateTime    @default(now()) // Data e hora de criação do registro do processo - DateTime - Valor padrão: Data/hora atual (definido apenas na criação)
  atualizadoEm            DateTime    @default(now()) @updatedAt // Data e hora da última atualização do registro - DateTime - Atualizado automaticamente a cada modificação
  andamentos              andamento[] // Lista de andamentos relacionados a este processo - Array de andamento - Histórico completo de movimentações do processo entre unidades

  @@map("processos")
}

// Model: andamento | Tabela: andamentos | Descrição: Armazena o histórico de movimentações dos processos entre unidades, controlando prazos e status
model andamento {
  id                     String          @id @default(uuid()) // ID único do andamento (UUID gerado automaticamente) - Chave primária
  origem                 String // Unidade de origem (de onde o processo está saindo) - String - Obrigatório - Nome ou sigla da unidade que está enviando o processo - Exemplo: "EXPEDIENTE", "COORDENADORIA_JURIDICA"
  destino                String // Unidade de destino (para onde o processo está indo) - String - Obrigatório - Nome ou sigla da unidade que receberá o processo - Exemplo: "COORDENADORIA_JURIDICA", "GABINETE"
  data_envio             DateTime? // Data em que o gabinete enviou o processo para a unidade - DateTime (opcional) - Data em que o processo foi efetivamente enviado da origem para o destino - Pode ser preenchida na criação ou posteriormente
  prazo                  DateTime        @default(now()) // Data limite para retorno do processo à unidade de origem - DateTime - Obrigatório - Valor padrão: Data/hora atual (deve ser ajustado ao criar) - Data até a qual o processo deve ser retornado. Se não retornado até esta data, está em atraso
  prorrogacao            DateTime? // Nova data limite caso o processo tenha sido prorrogado - DateTime (opcional) - Se preenchido, indica que o prazo foi prorrogado e esta é a nova data limite - Observação: Quando preenchido, o status deve ser alterado para PRORROGADO
  resposta               DateTime? // Data em que o processo recebeu resposta e foi retornado à unidade de origem - DateTime (opcional) - Data em que o processo foi finalizado e devolvido. Se preenchido, o status deve ser CONCLUIDO
  status                 StatusAndamento @default(EM_ANDAMENTO) // Status atual do andamento - Enum (StatusAndamento) - Valor padrão: EM_ANDAMENTO - Valores: EM_ANDAMENTO (em tramitação), CONCLUIDO (concluído e retornado), PRORROGADO (prazo prorrogado)
  observacao             String? // Observações sobre o andamento - String (opcional) - Campo livre para anotações, justificativas de prorrogação, ou outras informações relevantes
  ativo                  Boolean         @default(true) // Indica se o andamento está ativo (true) ou foi excluído logicamente (false) - Boolean - Valor padrão: true
  criadoEm               DateTime        @default(now()) // Data e hora de criação do registro do andamento - DateTime - Valor padrão: Data/hora atual (definido apenas na criação) - Representa a data em que o processo foi enviado da origem para o destino
  atualizadoEm           DateTime        @default(now()) @updatedAt // Data e hora da última atualização do registro - DateTime - Atualizado automaticamente a cada modificação
  processo_id            String // ID do processo relacionado (chave estrangeira) - String (UUID) - Obrigatório - Referência ao processo ao qual este andamento pertence
  processo               processo        @relation(fields: [processo_id], references: [id]) // Relacionamento com o modelo processo - Processo ao qual este andamento está vinculado
  usuario_id             String // ID do usuário que criou o andamento (chave estrangeira) - String (UUID) - Obrigatório - Referência ao usuário que criou este andamento
  usuario                Usuario         @relation("AndamentoCriadoPor", fields: [usuario_id], references: [id]) // Relacionamento com o modelo Usuario - Usuário que criou este andamento
  usuario_prorrogacao_id String? // ID do usuário que prorrogou o prazo (chave estrangeira) - String (UUID) - Opcional - Referência ao usuário que prorrogou este andamento - Só preenchido quando há prorrogação
  usuarioProrrogacao     Usuario?        @relation("AndamentoProrrogadoPor", fields: [usuario_prorrogacao_id], references: [id]) // Relacionamento com o modelo Usuario - Usuário que prorrogou este andamento

  @@map("andamentos")
}

// Model: Log | Tabela: logs | Descrição: Armazena o histórico de todas as ações realizadas no sistema para auditoria e rastreabilidade
model Log {
  id           String   @id @default(uuid()) // ID único do log (UUID gerado automaticamente) - Chave primária
  tipoAcao     TipoAcao // Tipo de ação realizada - Enum (TipoAcao) - Obrigatório - Define qual tipo de operação foi realizada
  descricao    String   // Descrição detalhada da ação realizada - String (TEXT no banco) - Obrigatório - Descrição completa do que foi feito, incluindo dados relevantes
  entidadeTipo String // Tipo da entidade afetada (processo, andamento, etc.) - String - Obrigatório - Identifica qual tipo de entidade foi afetada pela ação - Exemplo: "processo", "andamento"
  entidadeId   String // ID da entidade afetada - String (UUID) - Obrigatório - ID da entidade que foi criada, atualizada ou removida
  dadosAntigos String?  // Dados anteriores (em JSON) antes da alteração - String (TEXT no banco) - Opcional - Armazena o estado anterior da entidade em formato JSON para comparação
  dadosNovos   String?  // Dados novos (em JSON) após a alteração - String (TEXT no banco) - Opcional - Armazena o novo estado da entidade em formato JSON
  ativo        Boolean  @default(true) // Indica se o log está ativo (true) ou foi excluído logicamente (false) - Boolean - Valor padrão: true
  criadoEm     DateTime @default(now()) // Data e hora em que a ação foi realizada - DateTime - Valor padrão: Data/hora atual - Timestamp exato da ação
  usuario_id   String // ID do usuário que realizou a ação (chave estrangeira) - String (UUID) - Obrigatório - Referência ao usuário que executou a ação
  usuario      Usuario  @relation(fields: [usuario_id], references: [id]) // Relacionamento com o modelo Usuario - Usuário que realizou a ação

  @@index([usuario_id])
  @@index([entidadeTipo, entidadeId])
  @@index([tipoAcao])
  @@index([criadoEm])
  @@map("logs")
}
